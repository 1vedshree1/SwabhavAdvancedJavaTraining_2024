package com.techlabs.bank.config;

import org.springframework.batch.item.file.FlatFileItemWriter;
import org.springframework.batch.item.file.builder.FlatFileItemWriterBuilder;
import org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor;
import org.springframework.batch.item.file.transform.DelimitedLineAggregator;
import org.springframework.batch.item.file.transform.LineAggregator;
import org.springframework.core.io.FileSystemResource;
import org.springframework.stereotype.Component;

import com.techlabs.bank.dto.TransactionDto;

@Component
public class TransactionItemWriter {

    public FlatFileItemWriter<TransactionDto> writer() {
        BeanWrapperFieldExtractor<TransactionDto> fieldExtractor = new BeanWrapperFieldExtractor<>();
        fieldExtractor.setNames(new String[] { "transactionId", "transactionType", "amount", "accountNumber", "transferAccountNumber", "date" });

        LineAggregator<TransactionDto> lineAggregator = new DelimitedLineAggregator<TransactionDto>();
        lineAggregator.setFieldExtractor(fieldExtractor);

        return new FlatFileItemWriterBuilder<TransactionDto>()
            .name("transactionItemWriter")
            .resource(new FileSystemResource("transactions.csv"))
            .lineAggregator(lineAggregator)
            .build();
    }
}
