package com.techlabs.bank.config;

import org.springframework.batch.item.file.FlatFileItemWriter;
import org.springframework.batch.item.file.builder.FlatFileItemWriterBuilder;
import org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor;
import org.springframework.batch.item.file.transform.DelimitedLineAggregator;
import org.springframework.core.io.FileSystemResource;
import org.springframework.stereotype.Component;

import com.techlabs.bank.dto.TransactionDto;

@Component
public class TransactionItemWriter {

    public FlatFileItemWriter<TransactionDto> writer() {
        // Define field extractor to specify which fields should be written to the CSV
        BeanWrapperFieldExtractor<TransactionDto> fieldExtractor = new BeanWrapperFieldExtractor<>();
        fieldExtractor.setNames(new String[] { "transactionId", "transactionType", "amount", "accountNumber", "transferAccountNumber", "date" });
        
        // Define line aggregator to format the data into CSV
        DelimitedLineAggregator<TransactionDto> lineAggregator = new DelimitedLineAggregator<>();
        lineAggregator.setDelimiter(",");
        lineAggregator.setFieldExtractor(fieldExtractor);

        // Create FlatFileItemWriter using the line aggregator
        return new FlatFileItemWriterBuilder<TransactionDto>()
            .name("transactionItemWriter")
            .resource(new FileSystemResource("transactions.csv"))
            .lineAggregator(lineAggregator)
            .build();
    }
}
